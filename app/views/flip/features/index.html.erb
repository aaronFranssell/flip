<div class="flip">
  <div class="content">
    <h1>Feature Flippers</h1>

    <table>
      <thead>
        <th class="name">Name</th>
        <th class="description">Description</th>
        <th class="status">Status</th>
        <% @p.strategies.each do |strategy| %>
          <th>
            <%= strategy.name.titleize %>
            <span class="description"><%= strategy.description %></span>
          </th>
        <% end %>
        <th>
          Default
          <span class="description">The system default when no strategies match.</span>
        </th>
      </thead>
      <tbody>
      <% @p.definitions.each do |definition| %>
        <tr>
          <td class="name"><%= definition.name %></td>

          <td class="description"><%= definition.description %></td>

          <%= content_tag :td, class: @p.status(definition) do %>
            <span class='status'><%= (@p.status definition).titleize %></span>
          <% end %>

          <% @p.strategies.each do |strategy| %>
            <% strategy_status = @p.strategy_status(strategy, definition) %>
            <%= content_tag :td, class: strategy_status || "pass" do %>
              <span class='status'><%= strategy_status.to_s.titleize %></span>

              <% if strategy.switchable? %>
                <div class='strategy-wrapper'>
                  <%= form_tag(@p.switch_url(strategy, definition), method: :patch) do %>
                    <% unless strategy_status == "on" %>
                      <%= content_tag :div do %>
                        <%= button_tag "Switch On", name: 'commit', value: 'Switch On', class: 'button-on' %>
                      <% end %>
                    <% end %>
                    <% unless ['off', nil].include? strategy_status %>
                      <%= content_tag :div do %>
                        <%= button_tag "Switch Off", name: 'commit', value: 'Switch Off', class: 'button-off' %>
                      <% end %>
                    <% end %>
                  <% end %>
                  <% unless strategy_status.blank? %>
                    <%= content_tag :div do %>
                      <%= form_tag(@p.switch_url(strategy, definition), method: :delete) do %>
                        <%= button_tag "Delete", name: 'commit', value: 'Delete', class: 'button-delete' %>
                      <% end %>
                    <% end %>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          <% end %>

          <%= content_tag :td, class: @p.default_status(definition) do %>
            <span class='status'><%= (@p.default_status definition).titleize %></span>
          <% end %>

        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>
